---
- name: create adminer directory
  file: path={{ apache2_docroot }}/adminer state=directory
  sudo: true

- name: copy adminer
  copy: src=adminer-4.2.1.php dest={{ apache2_docroot }}/adminer/adminer-4.2.1.php
  sudo: true

- name: copy adminer stylesheet
  copy: src=adminer.css dest={{ apache2_docroot }}/adminer/adminer.css
  sudo: true

- name: copy index.php configuration file into place
  template: src=index.j2 dest={{ apache2_docroot }}/adminer/index.php
  sudo: true

- name: ensure adminer directory permissions
  file: path={{ apache2_docroot }}/adminer mode=0777 recurse=yes
  sudo: true

- name: add vhost for adminer (Debian)
  template: src=apache_adminer_vhost.j2 dest=/etc/apache2/sites-available/adminer.{{ webserver_hostname }}.conf
  when: ansible_os_family == "Debian"
  sudo: true
  notify:
    - restart apache2

- name: enable the adminer site (Debian)
  command: a2ensite adminer.{{ webserver_hostname }}.conf creates=/etc/apache2/sites-enabled/adminer.{{ webserver_hostname }}.conf
  sudo: true
  when: ansible_os_family == "Debian"
  notify:
    - restart apache2

- name: add vhost for adminer (RedHat)
  template: src=apache_adminer_vhost.j2 dest=/etc/httpd/vhosts/adminer.{{ webserver_hostname }}.conf
  when: ansible_os_family == "RedHat"
  sudo: true
  notify:
    - restart httpd